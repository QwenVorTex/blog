---
interface Props {
  title: string;
  description: string;
  href: string;
  pubDate: Date;
  heroColor?: 'yellow' | 'red' | 'blue' | 'black';
  tags?: string[];
  index?: number;
}

const { title, description, href, pubDate, heroColor = 'yellow', tags = [], index = 0 } = Astro.props;

const colorMap: Record<string, string> = {
  yellow: 'var(--color-accent)',
  red: 'var(--color-action)',
  blue: 'var(--color-link)',
  black: 'var(--color-border)',
};

const accentColor = colorMap[heroColor];
const textOnColor = heroColor === 'black' || heroColor === 'red' ? 'var(--color-surface)' : 'var(--color-text)';

const formattedDate = pubDate.toLocaleDateString('zh-CN', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});

// Deliberate slight rotations for brutalist asymmetry
const rotations = [0, -0.5, 0.3, -0.8, 0.6, -0.2];
const rotation = rotations[index % rotations.length];
---

<a href={href} class="post-card scroll-reveal" style={`--card-accent: ${accentColor}; --card-text: ${textOnColor}; --card-rotate: ${rotation}deg;`}>
  <div class="post-card__accent-bar"></div>
  <div class="post-card__body">
    <div class="post-card__meta text-label">
      <time datetime={pubDate.toISOString()}>{formattedDate}</time>
    </div>
    <h3 class="post-card__title">{title}</h3>
    <p class="post-card__desc">{description}</p>
    {tags.length > 0 && (
      <div class="post-card__tags">
        {tags.slice(0, 3).map((tag) => (
          <span class="tag tag--accent">{tag}</span>
        ))}
      </div>
    )}
  </div>
  <div class="post-card__arrow">â†’</div>
</a>

<style>
  .post-card {
    display: block;
    background: var(--color-surface);
    border: var(--border-thick);
    box-shadow: var(--shadow-lg);
    text-decoration: none;
    color: var(--color-text);
    position: relative;
    overflow: hidden;
    transform: rotate(var(--card-rotate, 0deg));
    transition: transform var(--dur-fast) var(--steps-small),
                box-shadow var(--dur-fast) var(--steps-small);
  }

  .post-card:hover {
    transform: rotate(0deg) translate(-4px, -4px);
    box-shadow: 12px 12px 0px 0px var(--color-border);
    color: var(--color-text);
    text-decoration: none;
  }

  .post-card__accent-bar {
    height: 8px;
    background: var(--card-accent);
  }

  .post-card__body {
    padding: var(--space-5) var(--space-6);
  }

  .post-card__meta {
    margin-bottom: var(--space-3);
    color: var(--color-text-muted);
  }

  .post-card__title {
    font-size: var(--text-xl);
    margin-bottom: var(--space-3);
    text-transform: none;
    border-bottom: none;
    padding-bottom: 0;
    line-height: var(--leading-snug);
  }

  .post-card__desc {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-4);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .post-card__arrow {
    position: absolute;
    bottom: var(--space-4);
    right: var(--space-5);
    font-size: var(--text-2xl);
    font-weight: 900;
    opacity: 0;
    transform: translateX(-10px);
    transition: opacity var(--dur-fast) var(--steps-small),
                transform var(--dur-fast) var(--steps-small);
  }

  .post-card:hover .post-card__arrow {
    opacity: 1;
    transform: translateX(0);
  }
</style>
